{"files":[{"id":"0fa2aefc-f8d6-42d7-942c-237428668911","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Los_Angeles\",\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Gmail\",\n        \"serviceId\": \"gmail\",\n        \"version\": \"v1\"\n      }\n    ],\n    \"libraries\": [\n      {\n        \"userSymbol\": \"ESRequestForm\",\n        \"version\": \"0\",\n        \"libraryId\": \"1wit2Ynib-NE1263qxTeO7dLg0d6zge4w7y4rdgtBLsD-lMBrWWBnqmmu\",\n        \"developmentMode\": true\n      }\n    ]\n  },\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"MYSELF\"\n  }\n}"},{"id":"504469a8-85f9-4dae-bafe-27c98a1dfbc9","name":"GlobalAccess","type":"server_js","source":"function getTeacherDatabase(sheetName) {\n  return SpreadsheetApp.openById(getTeacherDatabaseId()).getSheetByName(\n    sheetName\n  );\n}\nfunction getTeacherDatabaseId() {\n  return \"14dpcYSc2czxXPRXEUd7KpXuo5htTYUMR9D-lbFv2zhg\";\n}\n\nfunction getStudentDatabase(sheetName) {\n  return SpreadsheetApp.openById(getStudentDatabaseId()).getSheetByName(\n    sheetName\n  );\n}\nfunction getStudentDatabaseId() {\n  return \"1xVmxYbDLOya0v3Lp81QaKW0ngfjmKI3CbPkG6HLj8-4\";\n}\n\nfunction getRequestForm() {\n  return FormApp.openById(getRequestFormId());\n}\nfunction getRequestFormId() {\n  return \"1kQRi6xMxOI9fbBLFIm5_K93RfD_O9cCfR0FBtbQvPp0\";\n}\n\nfunction getUpdaterTemplate() {\n  return SpreadsheetApp.openById(getUpdaterTemplateId());\n}\nfunction getUpdaterTemplateId() {\n  return \"1wN5-i-UzlyMcVYJdpMeKPVdjDs7q8FciXdg3M2ny2lc\";\n}\n\nfunction accessTeacherDB() {\n  return new TeacherDatabase(\"db\");\n}\n\nfunction accessStudentDB() {\n  return new StudentDatabase(\"db\");\n}\n\nfunction getSheetsFolderId() {\n  return \"1-HmF3zLgplS4JLxvwNyV3ny9mvb5WrIZ\";\n}\n\nfunction getWebAppURL() {\n  return \"https://script.google.com/macros/s/AKfycbw5bOQlUeOZ8xJ9seP6iyXtrb6Ummjyt91BbdGMOumX4bJhmHvHH_d8ZVzNhdOUKkDEyw/exec\";\n}\n"},{"id":"a48c3f98-bd8e-4516-ae3c-d76ab3caa216","name":"Email","type":"server_js","source":"function getDateTime() {\n  let date \u003d new Date();\n\n  const [month, day, year] \u003d [\n    date.getMonth(),\n    date.getDate(),\n    date.getFullYear(),\n  ];\n\n  let time \u003d date.toLocaleTimeString();\n  \n  return `${month}/${day}/${year} ${time}`; \n}\n\nfunction acceptHTML(studentName, destination, homeroom) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027Accept\u0027);\n  template.name \u003d studentName;\n  template.datetime \u003d getDateTime(); \n  template.destination \u003d destination;\n  template.homeroom \u003d homeroom; \n\n  return template.evaluate().getContent();\n}\nfunction sendAcceptEmail(recipientEmail, studentName, destination, homeroom) {\n  const htmlBody \u003d acceptHTML(studentName, destination, homeroom);\n  \n  GmailApp.sendEmail(recipientEmail, `✅ Pass Approved For ${studentName}`, \u0027\u0027, {\n    htmlBody: htmlBody\n  });\n}\n\nfunction rejectHTML(studentName, destination, reason) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027Reject\u0027);\n  template.name \u003d studentName;\n  template.datetime \u003d getDateTime(); \n  template.destination \u003d destination;\n  template.reason \u003d reason; \n  \n  return template.evaluate().getContent();\n}\nfunction sendRejectEmail(recipientEmail, studentName, destination, reason) {\n  const htmlBody \u003d rejectHTML(studentName, destination, reason);\n  \n  GmailApp.sendEmail(recipientEmail, `❌ Pass Rejected For ${studentName}`, \u0027\u0027, {\n    htmlBody: htmlBody\n  });\n}\n\nfunction updateHTML(teacherName, newSSUrl) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027Update\u0027);\n  template.name \u003d teacherName;\n  template.url \u003d newSSUrl;\n  \n  return template.evaluate().getContent();\n}\nfunction sendUpdateEmail(recipientEmail, teacherName, newSSUrl) {\n  const htmlBody \u003d updateHTML(teacherName, newSSUrl);\n  \n  GmailApp.sendEmail(recipientEmail, `Your ET Sheet Was Updated, Please Follow The Instructions`, \u0027\u0027, {\n    htmlBody: htmlBody\n  });\n}\n\nfunction requestHTML(studentGmail, teacherGmail) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027Request\u0027);\n  template.studentGmail \u003d studentGmail;\n  template.teacherGmail \u003d teacherGmail;\n\n  return template.evaluate().getContent();\n}\nfunction sendRequestEmail(studentGmail, teacherGmail) {\n  const htmlBody \u003d requestHTML(studentGmail, teacherGmail);\n  \n  GmailApp.sendEmail(studentGmail, `‼️ Teacher Request ‼️`, \u0027\u0027, {\n    htmlBody: htmlBody\n  });\n}\n"},{"id":"b163748c-b802-4cd9-b032-bb010bc110e4","name":"Accept","type":"html","source":"\u003cDOCTYPE! html /\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle type\u003d\"text/css\"\u003e\n      body {\n        padding: 1rem;\n        margin: 0;\n        height: fit-content;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n      }\n      .intro {\n        height: auto;\n        width: auto;\n      }\n      .intro h1 {\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n      .info-container {\n        width: fit-content;\n        border: 1px solid rgb(0, 0, 0, 0.2);\n        padding: 2rem 5rem 2rem 5rem;\n        border-radius: 1rem;\n      }\n      .info {\n        height: 100%;\n        display: flex;\n      }\n      .info h1 {\n        font-size: 2rem;\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"intro\"\u003e\n      \u003ch1\u003e\n        Hello\n        \u003c?\u003d name ?\u003e,\u003cbr /\u003ehere is your update.\n      \u003c/h1\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"info-container\"\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003e\n          Status:\n          \u003cspan style\u003d\"color: green; font-weight: 500\"\u003e Accepted \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003e\n          Date \u0026 time:\n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d datetime ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003e\n          Destination:\n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d destination ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003e\n          Homeroom:\n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d homeroom ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n  \u003chtml /\u003e\n\u003c/html\u003e\n"},{"id":"030e517f-5179-4723-832a-1c7b859a4206","name":"Reject","type":"html","source":"\u003cDOCTYPE! html/\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle type\u003d\"text/css\"\u003e\n      body {\n        padding: 1rem;\n        margin: 0;\n        height: fit-content; \n        display: flex; \n        flex-direction: column; \n        justify-content: center; \n        align-items: center; \n      }\n      .intro {\n        height: auto;\n        width: auto; \n      }\n      .intro h1 {\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n      .info-container {\n        width: fit-content;\n        border: 1px solid rgb(0, 0, 0, 0.2);\n        padding: 2rem 5rem 2rem 5rem;\n        border-radius: 1rem;\n      }\n      .info {\n        height: 100%; \n        display: flex;\n      }\n      .info h1 {\n        font-size: 2rem; \n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"intro\"\u003e\n      \u003ch1\u003eHello \u003c?\u003d name ?\u003e,\u003cbr\u003ehere is your update.\u003c/h1\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"info-container\"\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003eStatus: \n          \u003cspan style\u003d\"color: red; font-weight: 500\"\u003e\n            Rejected\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003eDate \u0026 time:  \n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d datetime ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003eDestination:\n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d destination ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"info\"\u003e\n        \u003ch1\u003eReason:\n          \u003cspan style\u003d\"font-weight: 500\"\u003e\n            \u003c?\u003d reason ?\u003e\n          \u003c/span\u003e\n        \u003c/h1\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n\u003chtml/\u003e"},{"id":"4b2cb77b-5607-4959-a359-6db542f76e4b","name":"TeacherDatabase","type":"server_js","source":"class TeacherDatabase {\n  constructor(dbSheetName \u003d \"db\") {\n    this.db \u003d getTeacherDatabase(dbSheetName);\n  }\n\n  updateSettings(\n    sheetId,\n    { formName, room, email, automaticMode, substituteMode, maxAdditions }\n  ) {\n    const data \u003d this.getAllValues();\n    const targetRow \u003d data.findIndex((row) \u003d\u003e row[0] \u003d\u003d\u003d sheetId) + 2; //+2 since getAllValues() starts grabbing @ row 2\n\n    if (targetRow \u003e\u003d 2) {\n      const currStudents \u003d this.db\n        .getRange(targetRow, this.db.getLastColumn())\n        .getValue();\n      const newData \u003d [\n        sheetId,\n        formName,\n        room,\n        email,\n        automaticMode,\n        substituteMode,\n        maxAdditions,\n        currStudents,\n      ];\n      this.db\n        .getRange(targetRow, 1, 1, this.db.getLastColumn())\n        .setValues([newData]);\n    } else {\n      this.addData(sheetId, {\n        formName,\n        room,\n        email,\n        automaticMode,\n        substituteMode,\n        maxAdditions,\n      });\n    }\n\n    ESRequestForm.updateFormItems();\n  }\n\n  addData(\n    sheetId,\n    { formName, room, email, automaticMode, substituteMode, maxAdditions }\n  ) {\n    const data \u003d this.getAllValues();\n    const duplicate \u003d data.find((row) \u003d\u003e row[1] \u003d\u003d\u003d formName);\n\n    if (!duplicate) {\n      this.db.appendRow([\n        sheetId,\n        formName,\n        room,\n        email,\n        automaticMode,\n        substituteMode,\n        maxAdditions,\n        0,\n      ]);\n    }\n\n    ESRequestForm.updateFormItems();\n  }\n\n  setData(\n    prevSheetId,\n    {\n      newSheetId,\n      formName,\n      room,\n      email,\n      automaticMode,\n      substituteMode,\n      maxAdditions,\n    }\n  ) {\n    const data \u003d this.getAllValues();\n    const targetRow \u003d data.findIndex((row) \u003d\u003e row[0] \u003d\u003d\u003d prevSheetId) + 2; //+2 since getAllValues() starts grabbing @ row 2\n    if (targetRow \u003e\u003d 2) {\n      const currStudents \u003d this.db\n        .getRange(targetRow, this.db.getLastColumn())\n        .getValue();\n      const newData \u003d [\n        newSheetId,\n        formName,\n        room,\n        email,\n        automaticMode,\n        substituteMode,\n        maxAdditions,\n        currStudents,\n      ];\n      this.db\n        .getRange(targetRow, 1, 1, this.db.getLastColumn())\n        .setValues([newData]);\n    }\n\n    ESRequestForm.updateFormItems();\n  }\n\n  getData(formName) {\n    return this.dataExists(formName) || [];\n  }\n\n  dataExists(formName) {\n    const data \u003d this.getAllValues();\n    const row \u003d data.find((row) \u003d\u003e row[1] \u003d\u003d\u003d formName);\n    return row || false;\n  }\n\n  isTeacherFull(formName) {\n    const data \u003d this.getData(formName);\n    if (data.length \u003c 8) return false;\n    return data[7] \u003e\u003d data[6];\n  }\n\n  changeCurrentStudent(formName, changeByVal) {\n    const data \u003d this.getAllValues();\n    const rowData \u003d this.getData(formName);\n    const targetRow \u003d data.findIndex((row) \u003d\u003e row[1] \u003d\u003d\u003d formName) + 2; //+2 since getAllValues() starts grabbing @ row 2\n\n    if (targetRow \u003e\u003d 2 \u0026\u0026 rowData.length \u003e\u003d 8) {\n      rowData[7] \u003d rowData[7] + changeByVal;\n      this.db\n        .getRange(targetRow, 1, 1, this.db.getLastColumn())\n        .setValues([rowData]);\n    }\n  }\n\n  getAllValues() {\n    return this.db\n      .getRange(2, 1, this.db.getLastRow(), this.db.getLastColumn())\n      .getValues();\n  }\n}\n"},{"id":"30156e82-1e3c-477b-aa6c-8c27d674238f","name":"StudentDatabase","type":"server_js","source":"class StudentDatabase {\n  constructor(dbSheetName \u003d \"db\") {\n    this.db \u003d getStudentDatabase(dbSheetName);\n  }\n\n  updateData(email, name, homeroom, destination, purpose, status) {\n    const data \u003d this.getAllValues();\n    const targetRow \u003d data.findIndex((row) \u003d\u003e row[0] \u003d\u003d\u003d email) + 2; //+2 since getAllValues() starts grabbing @ row 2\n\n    const newData \u003d [email, name, homeroom, destination, purpose, status];\n    if (targetRow \u003e\u003d 2) {\n      this.db\n        .getRange(targetRow, 1, 1, this.db.getLastColumn())\n        .setValues([newData]);\n    } else {\n      this.addData(email, name, homeroom, destination, purpose, status);\n    }\n  }\n\n  addData(email, name, homeroom, destination, purpose, status) {\n    this.db.appendRow([email, name, homeroom, destination, purpose, status]);\n  }\n\n  setData(prevEmail, { email, name, homeroom, destination, purpose, status }) {\n    const data \u003d this.getAllValues();\n    const targetRow \u003d data.findIndex((row) \u003d\u003e row[0] \u003d\u003d\u003d prevEmail) + 2; //+2 since getAllValues() starts grabbing @ row 2\n    if (targetRow \u003e\u003d 2) {\n      const newData \u003d [email, name, homeroom, destination, purpose, status];\n      this.db\n        .getRange(targetRow, 1, 1, this.db.getLastColumn())\n        .setValues([newData]);\n    }\n  }\n\n  getData(email) {\n    return this.dataExists(email) || [];\n  }\n\n  dataExists(email) {\n    const data \u003d this.getAllValues();\n    const row \u003d data.find((row) \u003d\u003e row[0] \u003d\u003d\u003d email);\n    return row || false;\n  }\n\n  resetAll() {\n    if (this.db.getLastRow() \u003e 1) {\n      this.db\n        .getRange(2, 2, this.db.getLastRow() - 1, this.db.getLastColumn() - 1)\n        .clearContent();\n    }\n  }\n\n  getAllValues() {\n    return this.db\n      .getRange(2, 1, this.db.getLastRow(), this.db.getLastColumn())\n      .getValues();\n  }\n}\n"},{"id":"2f77819e-c319-4afb-bf2a-a0642e375c97","name":"Update","type":"html","source":"\u003cDOCTYPE! html /\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle type\u003d\"text/css\"\u003e\n      body {\n        padding: 1rem;\n        margin: 0;\n        height: fit-content;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n      }\n      .intro {\n        height: auto;\n        width: auto;\n      }\n      .intro h1 {\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n      .instructions-container {\n        width: fit-content;\n        border: 1px solid rgb(0, 0, 0, 0.2);\n        padding: 2rem 5rem 2rem 5rem;\n        border-radius: 1rem;\n      }\n      .instructions {\n        height: 100%;\n      }\n      .instructions h1 {\n        font-size: 2rem;\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"intro\"\u003e\n      \u003ch1\u003e\n        Hello\n        \u003c?\u003d name ?\u003e,\u003cbr /\u003ewe\u0027ve updated your ET spreadsheet.\n        \u003cbr /\u003e\n        New spreadsheet url:\n        \u003c?\u003d url?\u003e\n        \u003cbr /\u003e\n        \u003cbr /\u003e\n        Please follow the instructions.\n      \u003c/h1\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"instructions-container\"\u003e\n      \u003cdiv class\u003d\"instructions\"\u003e\n        \u003ch1\u003eInstructions:\u003c/h1\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"instructions\"\u003e\n        \u003ch1\u003e1. Disregard the old spreadsheet.\u003c/h1\u003e\n        \u003ch1\u003e2. Open the new, recently-shared spreadsheet.\u003c/h1\u003e\n        \u003ch1\u003e3. Configure and save your settings immediately.\u003c/h1\u003e\n        \u003ch1\u003e4. Contact the ET team if you have any issues.\u003c/h1\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n  \u003chtml /\u003e\n\u003c/html\u003e\n"},{"id":"f16ba875-56f4-4af9-a200-920b0b46edc7","name":"HandleAccept","type":"server_js","source":"function handleAccept(teacherBundle, studentBundle) {\n  //student has to be alr be in db; overwriting students will overwrite student db so dw\n  const acceptedStudent \u003d accessStudentDB().getData(studentBundle.email);\n  if (acceptedStudent[5] \u003d\u003d\u003d \"_ACCEPTED_\") return;\n\n  const homeTeacherSheet \u003d SpreadsheetApp.openById(\n    teacherBundle.homeSheetId\n  ).getSheetByName(\"Outgoing\");\n\n\n  //no need for currStudents ++ since pending already does it;\n\n  //update homeroom teacher by adding to outgoing\n  let range \u003d homeTeacherSheet.getDataRange();\n  let values \u003d range.getValues();\n  let rowSelect \u003d 2;\n  //do not use !values[rowSelect][1] even tho it works for normal js\n\n  while (values[rowSelect][2] \u0026\u0026 values[rowSelect][2] !\u003d studentBundle.email) {\n    rowSelect++;\n  }\n  rowRange \u003d homeTeacherSheet.getRange(rowSelect + 1, 2, 1, 4);\n  rowRange.setValues([\n    [\n      studentBundle.name,\n      studentBundle.email,\n      studentBundle.destination,\n      studentBundle.purpose,\n    ],\n  ]);\n\n  //update student database\n  accessStudentDB().updateData(\n    studentBundle.email,\n    studentBundle.name,\n    studentBundle.homeroom,\n    studentBundle.destination,\n    studentBundle.purpose,\n    \"_ACCEPTED_\"\n  );\n\n  \n  sendAcceptEmail(\n    studentBundle.email,\n    studentBundle.name,\n    studentBundle.destination,\n    studentBundle.homeroom\n  );\n}\n"},{"id":"b63b7227-0c88-4694-bc87-f84b5fab1086","name":"HandleReject","type":"server_js","source":"function handleReject(teacherBundle, studentBundle, reason, changeCurrStudent\u003dtrue) {\n  //destination teacher curr students --;\n  if (changeCurrStudent) {\n      accessTeacherDB().changeCurrentStudent(teacherBundle.destTeacher, -1);\n  }\n\n  //remove student from home teacher sheet regardless\n  const homeTeacherSheet \u003d SpreadsheetApp.openById(\n    teacherBundle.homeSheetId\n  ).getSheetByName(\"Outgoing\");\n  let range \u003d homeTeacherSheet.getDataRange();\n  let values \u003d range.getValues();\n  let rowSelect \u003d 2;\n  while (\n    rowSelect \u003c values.length \u0026\u0026\n    values[rowSelect][2] !\u003d studentBundle.email\n  ) {\n    rowSelect++;\n  }\n  rowRange \u003d homeTeacherSheet.getRange(rowSelect + 1, 2, 1, 4);\n  rowRange.setValues([[\"\", \"\", \"\", \"\"]]);\n  rowRange.setBackground(null);\n\n  //remove student from student db\n  accessStudentDB().setData(studentBundle.email, {\n    email: \"\",\n    name: \"\",\n    homeroom: \"\",\n    destination: \"\",\n    purpose: \"\",\n    status: \"\",\n  });\n\n  //send email to student\n  sendRejectEmail(\n    studentBundle.email,\n    studentBundle.name,\n    studentBundle.destination,\n    reason\n  );\n  //handleSubmitted auto removes student from homeroom teacher\n  //only acceptances will be added to homeroom teacher\n}\n"},{"id":"d08bdf92-4862-4cc5-a61a-3884ace400f3","name":"HandlePending","type":"server_js","source":"function handlePending(teacherBundle, studentBundle) {\n  const destTeacherSheet \u003d SpreadsheetApp.openById(\n    teacherBundle.destSheetId\n  ).getSheetByName(\"Incoming\");\n\n  //add student to destTeacherSheet, keep accepted false\n  let range \u003d destTeacherSheet.getDataRange();\n  let values \u003d range.getValues();\n\n  let rowSelect \u003d 2;\n  while (rowSelect \u003c values.length \u0026\u0026 values[rowSelect][1] !\u003d \"\") {\n    rowSelect++;\n  }\n  //if rowSelect is greater than max rows, append a new row\n  if (rowSelect \u003e destTeacherSheet.getMaxRows() - 1) {\n    let example \u003d destTeacherSheet.getRange(\n      destTeacherSheet.getLastRow(),\n      1,\n      1,\n      destTeacherSheet.getLastColumn()\n    );\n    destTeacherSheet.appendRow([destTeacherSheet.getLastRow() - 1]);\n    let newRow \u003d destTeacherSheet.getRange(\n      destTeacherSheet.getLastRow(),\n      1,\n      1,\n      destTeacherSheet.getLastColumn()\n    );\n    example.copyTo(newRow, { formatOnly: true });\n  }\n\n  let rowRange \u003d destTeacherSheet.getRange(rowSelect + 1, 2, 1, 6);\n  rowRange.setValues([\n    [\n      studentBundle.name,\n      studentBundle.email,\n      studentBundle.homeroom,\n      studentBundle.purpose,\n      false,\n      false,\n    ],\n  ]);\n\n  //currStudents ++ regardless\n  accessTeacherDB().changeCurrentStudent(teacherBundle.destTeacher, 1);\n\n  //add student to student database\n  accessStudentDB().updateData(\n    studentBundle.email,\n    studentBundle.name,\n    studentBundle.homeroom,\n    studentBundle.destination,\n    studentBundle.purpose,\n    \"_PENDING_\"\n  );\n\n  //the homeroom teacher won\u0027t receive until destination accepts the student\n}\n"},{"id":"48e77df5-0662-4f7f-b8ba-68235fc8d0ca","name":"HandleSubmitted","type":"server_js","source":"function handleSubmitted(oldData) {\n  const oldDestTeacher \u003d oldData[3].split(\" @ \")[0];\n  const oldDestSheet \u003d SpreadsheetApp.openById(\n    accessTeacherDB().getData(oldDestTeacher)[0]\n  ).getSheetByName(\"Incoming\");\n\n  //remove student from destination teacher sheet\n  //if student does not exist, it will throw an error\n  let range \u003d oldDestSheet.getDataRange();\n  let values \u003d range.getValues();\n  let rowSelect \u003d 2;\n  while (rowSelect \u003c values.length \u0026\u0026 values[rowSelect][2] !\u003d oldData[0]) {\n    rowSelect++;\n  }\n  let rowRange \u003d oldDestSheet.getRange(rowSelect + 1, 2, 1, 6);\n  rowRange.setValues([[\"\", \"\", \"\", \"\", false, false]]);\n  accessTeacherDB().changeCurrentStudent(oldDestTeacher, -1);\n\n  //clear homeroom only if prev accepted\n  if (oldData[5] \u003d\u003d\u003d \"_ACCEPTED_\") {\n    const oldHomeTeacher \u003d oldData[2].split(\" @ \")[0];\n    const oldHomeSheet \u003d SpreadsheetApp.openById(\n      accessTeacherDB().getData(oldHomeTeacher)[0]\n    ).getSheetByName(\"Outgoing\");\n    range \u003d oldHomeSheet.getDataRange();\n    values \u003d range.getValues();\n    rowSelect \u003d 2;\n    while (rowSelect \u003c values.length \u0026\u0026 values[rowSelect][2] !\u003d oldData[0]) {\n      rowSelect++;\n    }\n    rowRange \u003d oldHomeSheet.getRange(rowSelect + 1, 2, 1, 4);\n    rowRange.setValues([[\"\", \"\", \"\", \"\"]]);\n  }\n\n  //no need to update student database since pending does it and reject clears it\n}\n"},{"id":"3669e168-b811-4ade-a01f-843f3a843f99","name":"HandleAbsent","type":"server_js","source":"function handleAbsent(studentBundle) {\n  //get homeroom teacher sheet\n  const homeTeacher \u003d studentBundle.homeroom.split(\" @ \")[0];\n  const homeTeacherSheet \u003d SpreadsheetApp.openById(\n    accessTeacherDB().getData(homeTeacher)[0]\n  ).getSheetByName(\"Outgoing\");\n\n  //find student in outgoing sheet and mark them grey\n  let range \u003d homeTeacherSheet.getDataRange();\n  let values \u003d range.getValues();\n  let rowSelect \u003d 2;\n  while (\n    rowSelect \u003c values.length \u0026\u0026\n    values[rowSelect][2] !\u003d studentBundle.email\n  ) {\n    rowSelect++;\n  }\n  let rowRange \u003d homeTeacherSheet.getRange(\n    rowSelect + 1,\n    2,\n    1,\n    homeTeacherSheet.getLastColumn() - 1\n  );\n  rowRange.setBackground(\"grey\");\n\n  //update status\n  accessStudentDB().updateData(\n    studentBundle.email,\n    studentBundle.name,\n    studentBundle.email,\n    studentBundle.destination,\n    studentBundle.purpose,\n    \"_ABSENT_\"\n  );\n}\n"},{"id":"5d80cab7-554b-4605-ae95-7b7ab75855b1","name":"Request","type":"html","source":"\u003cDOCTYPE! html /\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle type\u003d\"text/css\"\u003e\n      body {\n        padding: 1rem;\n        margin: 0;\n        height: fit-content;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n      }\n      .intro {\n        height: auto;\n        width: auto;\n      }\n      .intro h1 {\n        font-family: Helvetica, -apple-system;\n        font-weight: 200;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"intro\"\u003e\n      \u003ch1\u003e\n        Hello\n        \u003c?\u003d studentGmail ?\u003e,\u003cbr /\u003e \u003c?\u003d teacherGmail ?\u003e has requested for you.\n        \u003cbr /\u003e\n        \u003cbr /\u003e\n        Please fill out the ESilverSlip Form.\n        \u003cbr /\u003e\n        \u003cbr /\u003e\n        https://tinyurl.com/esilverslip-form\n      \u003c/h1\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n  \u003chtml /\u003e\n\u003c/html\u003e\n"},{"id":"819cc89a-b6eb-4fee-b4ff-1cc4711fa827","name":"isETTime","type":"server_js","source":"function getTimeFrame() {\n  const date \u003d new Date();\n  const day \u003d date.getDay();\n\n  const hour \u003d date.getHours();\n  const minute \u003d date.getMinutes();\n\n  return {\n    day: day,\n    hour: hour,\n    minute: minute,\n  };\n}\n\nfunction isETTime() {\n  const {hour, minute} \u003d getTimeFrame();\n  if (hour \u003d\u003d\u003d 13 \u0026\u0026 minute \u003d\u003d\u003d 22) {\n    return true; \n  }\n  return false;\n}"}]}